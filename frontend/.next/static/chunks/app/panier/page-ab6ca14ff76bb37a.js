(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[666],{183:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var i=r(5155),a=r(2115),o=r(6597);function n(){let[e,t]=(0,a.useState)([]),[r,n]=(0,a.useState)(0),[s,l]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=localStorage.getItem("panier");if(e){let r=JSON.parse(e);t(r),n(r.reduce((e,t)=>e+Number(t.prix),0))}l(localStorage.getItem("userId"))},[]);let d=r=>{let i=e.filter(e=>e.id!==r);t(i),localStorage.setItem("panier",JSON.stringify(i));let a=e.find(e=>e.id===r);a&&n(e=>e-Number(a.prix))},c=Number(r).toFixed(2)+" €",u=e=>{let t=new o.uE,r=10;t.setFontSize(16),t.text("Vos E-tickets pour les Jeux Olympiques",10,r),r+=10,e.forEach((e,i)=>{t.setFontSize(14),t.text("R\xe9servation ".concat(i+1," - ID: ").concat(e.reservation_id),10,r),r+=8,t.setFontSize(12),t.text(e.message,10,r),r+=8,e.billets.forEach(e=>{let i="data:image/png;base64,"+e.qr_code_base64;t.addImage(i,"PNG",10,r,50,50),(r+=60)>250&&(t.addPage(),r=10)}),(r+=10)>250&&(t.addPage(),r=10)}),t.save("etickets.pdf")},h=async()=>{if(0===e.length)return void alert("Votre panier est vide.");if(!s){confirm("Vous devez \xeatre connect\xe9 pour r\xe9server. Voulez-vous vous connecter ?")&&(window.location.href="/connexion");return}try{let r=[];for(let t of e){let e={utilisateur_id:s,offre_id:t.id,date_heure_event:t.date_heure,nombre_billets:1},i=await fetch("http://127.0.0.1:5000/reserver",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await i.json();if(!i.ok)throw Error(a.error||"Erreur lors de la r\xe9servation");r.push(a)}u(r),alert("R\xe9servation confirm\xe9e ! Retrouvez vos billets dans votre profil."),t([]),localStorage.removeItem("panier"),n(0),window.location.href="/profil"}catch(e){alert("Erreur lors de la validation de la r\xe9servation: "+e.message)}};return(0,i.jsxs)("div",{className:"page-container",children:[(0,i.jsx)("h1",{children:"Votre Panier"}),0===e.length?(0,i.jsx)("p",{children:"Votre panier est vide."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("ul",{children:e.map(e=>(0,i.jsxs)("li",{className:"panier-item",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:e.nom})," — ",Number(e.prix).toFixed(2)," €"]}),(0,i.jsx)("button",{onClick:()=>d(e.id),children:"Retirer"})]},e.id))}),(0,i.jsxs)("h2",{style:{fontSize:"2.5em",fontWeight:"bold",color:"#0077cc",textAlign:"center",margin:"20px 0"},children:["Total : ",c]}),(0,i.jsx)("button",{className:"btn-valid",onClick:h,children:"Valider la r\xe9servation"})]})]})}r(4116)},4116:()=>{},8505:(e,t,r)=>{Promise.resolve().then(r.bind(r,183))}},e=>{var t=t=>e(e.s=t);e.O(0,[773,930,913,441,684,358],()=>t(8505)),_N_E=e.O()}]);